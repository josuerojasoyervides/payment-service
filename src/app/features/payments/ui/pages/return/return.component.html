<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-xl mx-auto px-4">
    <!-- Header -->
    <div class="text-center mb-8">
      @if (isCancel()) {
        <div
          class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12" />
          </svg>
        </div>
        <h1 class="text-2xl font-bold text-gray-900">{{ i18nLabels.paymentCanceled() }}</h1>
        <p class="text-gray-600 mt-2">{{ i18nLabels.paymentCanceledMessage() }}</p>
      } @else if (isSuccess()) {
        <div
          class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 13l4 4L19 7" />
          </svg>
        </div>
        <h1 class="text-2xl font-bold text-gray-900">{{ i18nLabels.paymentCompleted() }}</h1>
        <p class="text-gray-600 mt-2">{{ i18nLabels.paymentCompletedMessage() }}</p>
      } @else {
        <div
          class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg
            class="w-8 h-8 text-blue-600 animate-spin"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
        </div>
        <h1 class="text-2xl font-bold text-gray-900">{{ i18nLabels.verifyingPayment() }}</h1>
        <p class="text-gray-600 mt-2">{{ i18nLabels.verifyingPaymentMessage() }}</p>
      }
    </div>

    <!-- Flow error surface -->
    @if (flowState.hasError() && flowState.error(); as err) {
      <div class="alert-error mb-6">
        <div class="flex items-start gap-3">
          <svg
            class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="flex-1">
            <p class="font-medium text-red-800">{{ getErrorMessage(err) }}</p>
            <button class="btn-primary mt-3" (click)="clearErrorAndRetry()">
              {{ i18nLabels.tryAgainLabel() }}
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Query Params Info -->
    <div class="card mb-6">
      <h2 class="text-lg font-semibold mb-4">{{ i18nLabels.returnInformation() }}</h2>

      <dl class="space-y-3 text-sm">
        @if (returnPageState.intentId()) {
          <div class="flex justify-between">
            <dt class="text-gray-500">{{ i18nLabels.intentIdLabel() }}</dt>
            <dd class="font-mono text-gray-900">{{ returnPageState.intentId() }}</dd>
          </div>
        }

        @if (returnPageState.paypalToken()) {
          <div class="flex justify-between">
            <dt class="text-gray-500">{{ i18nLabels.paypalTokenLabel() }}</dt>
            <dd class="font-mono text-gray-900">{{ returnPageState.paypalToken() }}</dd>
          </div>
        }

        @if (returnPageState.paypalPayerId()) {
          <div class="flex justify-between">
            <dt class="text-gray-500">{{ i18nLabels.paypalPayerIdLabel() }}</dt>
            <dd class="font-mono text-gray-900">{{ returnPageState.paypalPayerId() }}</dd>
          </div>
        }

        <div class="flex justify-between">
          <dt class="text-gray-500">{{ i18nLabels.flowTypeLabel() }}</dt>
          <dd class="text-gray-900">{{ flowType() }}</dd>
        </div>

        <div class="flex justify-between">
          <dt class="text-gray-500">{{ i18nLabels.statusLabel() }}</dt>
          <dd>
            @if (isCancel()) {
              <span class="badge-error">{{ i18nLabels.canceled() }}</span>
            } @else if (isSuccess()) {
              <span class="badge-success">{{ i18nLabels.completed() }}</span>
            } @else {
              <span class="badge-processing">{{ i18nLabels.processing() }}</span>
            }
          </dd>
        </div>
      </dl>
    </div>

    <!-- Current Intent from State -->
    @if (flowState.currentIntent(); as intent) {
      <div class="mb-6">
        <h2 class="text-lg font-semibold mb-4">{{ i18nLabels.paymentStatus() }}</h2>
        <app-payment-intent-card
          [intent]="intent"
          [showActions]="true"
          (confirm)="confirmPayment($event)"
          (refresh)="refreshPaymentByReference($event)" />
      </div>
    }

    <!-- Actions -->
    <div class="flex flex-col sm:flex-row gap-3">
      <a routerLink="/payments/checkout" class="btn-primary flex-1 text-center">
        @if (isCancel()) {
          {{ i18nLabels.retryPayment() }}
        } @else {
          {{ i18nLabels.newPaymentButton() }}
        }
      </a>

      <a routerLink="/payments/history" class="btn-secondary flex-1 text-center">
        {{ i18nLabels.viewHistory() }}
      </a>
    </div>

    <!-- Debug -->
    <details class="mt-8">
      <summary class="text-sm text-gray-500 cursor-pointer">
        {{ i18nLabels.viewAllParams() }}
      </summary>
      <pre class="mt-2 p-4 bg-gray-100 rounded-lg text-xs overflow-auto">{{
        returnPageState.allParams() | json
      }}</pre>
    </details>

    <!-- Flow debug panel (dev) -->
    <app-flow-debug-panel />
  </div>
</div>

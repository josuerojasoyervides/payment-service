<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-xl mx-auto px-4">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-2xl font-bold text-gray-900">{{ labels.consultStatusTitle() }}</h1>
      <p class="text-gray-600 mt-2">
        {{ labels.enterPaymentIdText() }}
      </p>
    </div>

    <!-- Search Form -->
    <div class="card mb-6">
      <div class="space-y-4">
        <!-- Intent ID Input -->
        <div>
          <label for="intentId" class="label">
            {{ labels.intentIdLabel() }}
          </label>
          <input
            id="intentId"
            type="text"
            class="input font-mono"
            [placeholder]="labels.intentIdPlaceholder()"
            [(ngModel)]="intentIdModel"
            (keyup.enter)="searchIntent()" />
          <p class="text-xs text-gray-500 mt-1">
            {{ labels.exampleStripeText() }}
          </p>
        </div>

        <!-- Provider selection (from catalog) -->
        <app-provider-selector
          [descriptors]="providerDescriptors()"
          [selected]="statusPageState.selectedProvider()"
          [disabled]="flowState.isLoading()"
          (providerChange)="selectProvider($event)" />

        <!-- Search Button -->
        <button class="btn-primary w-full" [disabled]="isSearchDisabled()" (click)="searchIntent()">
          @if (flowState.isLoading()) {
            <div class="spinner mr-2"></div>
            {{ labels.consultingLabel() }}
          } @else {
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            {{ labels.checkStatusLabel() }}
          }
        </button>
      </div>
    </div>

    <!-- Error -->
    @if (flowState.error(); as err) {
      <div class="alert-error mb-6">
        <div class="flex items-start gap-3">
          <svg
            class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div>
            <p class="font-medium">{{ labels.errorConsultingLabel() }}</p>
            <p class="text-sm mt-1">{{ getErrorMessage(err) }}</p>
          </div>
        </div>
      </div>
    }

    <!-- Result -->
    @if (result(); as intent) {
      <div class="space-y-4">
        <h2 class="text-lg font-semibold text-gray-900">{{ labels.resultLabel() }}</h2>

        <app-payment-intent-card
          [intent]="intent"
          [showActions]="true"
          [expanded]="true"
          (confirm)="confirmPayment($event)"
          (canceled)="cancelPayment($event)"
          (refresh)="refreshPayment($event)" />

        @if (intent.nextAction) {
          <app-next-action-card
            [nextAction]="intent.nextAction"
            (actionRequested)="onNextActionRequested($event)" />
        }
      </div>
    }

    <!-- Quick Examples -->
    <div class="mt-8">
      <h3 class="text-sm font-medium text-gray-700 mb-3">{{ labels.quickExamplesLabel() }}</h3>
      <div class="flex flex-wrap gap-2">
        @for (example of examples(); track example.id) {
          <button
            class="text-xs px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700 transition-colors"
            (click)="useExample(example)">
            {{ example.label }}
          </button>
        }
      </div>
    </div>

    <!-- Navigation -->
    <div class="mt-8 flex justify-center gap-4 text-sm">
      <a routerLink="/payments/checkout" class="text-blue-600 hover:underline">
        {{ labels.checkoutLabel() }}
      </a>
      <a routerLink="/payments/history" class="text-blue-600 hover:underline">
        {{ labels.historyLabel() }}
      </a>
    </div>

    <!-- Flow debug panel (dev) -->
    <app-flow-debug-panel />
  </div>
</div>

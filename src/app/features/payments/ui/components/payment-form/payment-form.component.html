<div class="space-y-4">
  @if (requirements(); as reqs) {
    @if (reqs.descriptionKey | i18n; as description) {
      <p class="text-sm text-gray-600">{{ description }}</p>
    }

    @if (reqs.instructionsKey) {
      <div class="alert-info flex items-start gap-2">
        <span class="text-lg">ðŸ’¡</span>
        @if (reqs.instructionsKey | i18n; as instructions) {
          <span class="text-sm">{{ instructions }}</span>
        }
      </div>
    }

    <form class="space-y-4">
      @for (field of visibleFields(); track field.name; let index = $index) {
        <div class="space-y-1">
          @if (field.name === 'saveForFuture') {
            @let node = flagField(field.name);

            @if (node) {
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  [formField]="node"
                  class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                <span class="label cursor-pointer">
                  {{ field.labelKey | i18n }}
                </span>
              </label>
            }
          } @else {
            @let node = textField(field.name);
            @let invalid = isFieldInvalid(field.name);

            @if (node) {
              <label [for]="field.name" class="label">
                {{ field.labelKey | i18n }}
                @if (field.required) {
                  <span class="text-red-500 ml-0.5">*</span>
                }
              </label>

              <input
                [id]="field.name"
                [type]="field.type"
                [formField]="node"
                [placeholder]="field.placeholderKey | i18n"
                class="input"
                [appAutofocus]="index === 0"
                [class.input-error]="invalid"
                (blur)="markTextFieldTouched(field.name)" />

              @if (invalid) {
                <p class="text-sm text-red-500">
                  {{ fieldRequiredText() }}
                </p>
              }
            }
          }
        </div>
      }

      @if (hiddenFields().length > 0) {
        <div class="text-xs text-gray-400 space-y-1">
          @for (field of hiddenFields(); track field.name) {
            <div class="flex items-center gap-2">
              <span>{{ field.labelKey | i18n }}:</span>
              <code class="bg-gray-100 px-1 rounded">
                {{ hiddenFieldDisplayValue(field.name) }}
              </code>
            </div>
          }
        </div>
      }
    </form>

    @if (reqs.fields.length === 0) {
      <p class="text-sm text-gray-500 italic">
        {{ methodNoAdditionalDataText() }}
      </p>
    }
  } @else {
    <p class="text-sm text-gray-500 italic">
      {{ selectProviderMethodText() }}
    </p>
  }
</div>
